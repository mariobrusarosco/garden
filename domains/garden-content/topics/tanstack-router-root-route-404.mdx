---
title: TanStack Router Root Route 404 in Production
summary: "Debugging and fixing root route 404 errors caused by stale route tree and incorrect file naming"
category: "frameworks"
author: mariobrusarosco.github.com
related-topics:
  - "tanstack-router"
  - "routing"
  - "react"
  - "vite"
  - "deployment"
  - "file-based-routing"
reference-links:
  - link: "https://tanstack.com/router/latest/docs/framework/react/guide/file-based-routing"
    text: "TanStack Router - File-Based Routing"
  - link: "https://tanstack.com/router/latest/docs/framework/react/guide/route-trees"
    text: "TanStack Router - Route Trees"
  - link: "https://tanstack.com/router/latest/docs/framework/react/guide/cli"
    text: "TanStack Router CLI"
planted-in: 2025-11-02
last-watered-in: 2025-11-02
---

# The Problem

Root route (`/`) returns 404 in production but works perfectly on localhost. The twist? The custom 404 page appears (not CloudFront's), meaning the app loads successfully but client-side routing is broken.

<Callout>
  **Key Insight:** When you see your app's custom 404 instead of a server/CDN error, the issue is with client-side routing, not infrastructure.
</Callout>

# Root Causes

## Issue 1: Stale Route Tree in Production

TanStack Router uses a generated file `src/routeTree.gen.ts` that contains all route configuration. This file:
- Is generated by `@tanstack/router-plugin` during development
- Must be **committed to git**
- Was **not being regenerated** during CI/CD builds

**The problem:**
- Route tree generates during `vite dev` but not during `vite build`
- If you update routes but don't regenerate and commit the tree, production deploys with outdated routing

**Evidence:**
```bash
# Local route tree was recently updated
$ ls -lh src/routeTree.gen.ts
-rw-rw-r-- 1 mario mario 2.1M Nov  2 16:29 src/routeTree.gen.ts

# But git showed it was last committed weeks ago
$ git log --oneline -1 -- src/routeTree.gen.ts
158e6dd [FIX] Lint errors  # Old commit!
```

## Issue 2: Incorrect File Naming Convention

The root index route was named `src/routes/index.route.tsx` instead of `src/routes/index.tsx`.

**The impact:**

```typescript
// WRONG - Generated from index.route.tsx
const IndexRouteRoute = IndexRouteRouteImport.update({
  id: '/',
  path: '',  // ‚ùå Empty path doesn't match '/'
  getParentRoute: () => rootRouteImport,
})

// CORRECT - Generated from index.tsx
const IndexRoute = IndexRouteImport.update({
  id: '/',
  path: '/',  // ‚úÖ Matches root URL
  getParentRoute: () => rootRouteImport,
})
```

An empty `path: ''` means the route won't match `/`, causing the router to fall through to the `notFoundComponent`.

# The Solution

## Part 1: Automate Route Generation

Install TanStack Router CLI:

```bash
yarn add -D @tanstack/router-cli
```

Add pre-commit hook:

```bash
# .husky/pre-commit
yarn generate-routes
git add src/routeTree.gen.ts
yarn lint-staged
```

**Benefits:**
- Route tree regenerates automatically before every commit
- Updated route tree always committed with route changes
- Production always has latest routing configuration
- No manual intervention needed

## Part 2: Fix File Naming

```bash
mv src/routes/index.route.tsx src/routes/index.tsx
```

TanStack Router's conventions:
- `index.tsx` ‚Üí Root index route with `path: '/'`
- `index.route.tsx` ‚Üí Treated differently, generates `path: ''`

# TanStack Router File Naming Conventions

## Standard Route Files

| File Name | Generated Route | Path |
|-----------|----------------|------|
| `index.tsx` | Root index | `/` |
| `about.tsx` | About page | `/about` |
| `posts.tsx` | Posts page | `/posts` |
| `posts/index.tsx` | Posts index | `/posts` |
| `posts/$id.tsx` | Post detail | `/posts/:id` |

## Layout Routes (Pathless)

| File Name | Generated Route | Path |
|-----------|----------------|------|
| `_layout.tsx` | Layout wrapper | No path (wraps children) |
| `_auth.tsx` | Auth layout | No path (wraps children) |

## Special Suffixes

| Suffix | Purpose | Note |
|--------|---------|------|
| `.lazy.tsx` | Code-split route | Lazy-loaded on access |
| `.route.tsx` | Alternative syntax | ‚ö†Ô∏è Avoid for index routes |

<Callout>
  **File naming matters!** TanStack Router uses file names to determine route paths, hierarchy, lazy-loading, and layouts. Always follow official conventions.
</Callout>

# üéì Key Learnings

## Build-Time Route Generation

Unlike routers that discover routes at runtime, TanStack Router:
- Scans `src/routes/` during development
- Generates static `routeTree.gen.ts` file
- **This file must be committed**
- Production uses committed file, not live generation

**Critical implication:** Update routes without committing the tree = broken production.

## Development vs Production Behavior

**Development:**
- Vite plugin watches file changes
- Route tree regenerates automatically
- Hot module replacement works
- Everything feels "magic" ‚ú®

**Production:**
- Uses committed route tree file
- No live generation
- Stale route tree = broken routes
- No HMR to mask issues

**Best practice:** Always test production builds locally:

```bash
yarn build --mode demo
yarn preview
```

## Debugging Client-Side Routing Issues

**Signs it's routing (not server/CDN):**
- ‚úÖ App loads (you see your UI)
- ‚úÖ Network tab shows successful requests (200/304)
- ‚úÖ You see custom 404 page (not server's 404)
- ‚ùå `beforeLoad` hooks don't run
- ‚ùå Console logs in route files don't appear

**Debug steps:**
1. Check route tree commit history: `git log src/routeTree.gen.ts`
2. Inspect route tree content for `path` values
3. Verify file naming follows conventions
4. Test production build locally: `yarn build && yarn preview`
5. Compare deployed bundle with local build

# Prevention Strategy

## Automated Pre-Commit Hook

```bash
# .husky/pre-commit
yarn generate-routes
git add src/routeTree.gen.ts
yarn lint-staged
```

## CI/CD Validation (Recommended)

```yaml
# .github/workflows/pr-validation.yml
- name: Check route tree is up-to-date
  run: |
    yarn generate-routes
    git diff --exit-code src/routeTree.gen.ts || \
      (echo "Route tree is out of date! Run 'yarn generate-routes' and commit." && exit 1)
```

## Ideal Development Workflow

1. Create/modify route files in `src/routes/`
2. Pre-commit hook runs automatically:
   - Generates route tree
   - Stages `routeTree.gen.ts`
   - Runs linting
3. Commit includes both route files and route tree
4. CI/CD builds with up-to-date configuration
5. Production works! ‚úÖ

# Summary

**Problem:** Root route 404 in production  
**Cause 1:** Stale route tree file in git  
**Cause 2:** Wrong file naming (`index.route.tsx` vs `index.tsx`)  
**Solution 1:** Auto-generate routes on pre-commit  
**Solution 2:** Rename to `index.tsx`  
**Result:** Routes work in production  

**Debug Time:** ~2 hours  
**Fix Time:** 5 minutes  
**Lesson:** File naming conventions and build-time generation are critical!